<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Customize Windows 10+ default theme | Nosari20</title><meta name=description content="Customize the Windows 10+ default theme using PowerShell script (wallpaper, lockscreen, etc.)"><meta name=author content="Florent NOSARI"><meta name=google-site-verification content="l3oU_IprnsBv0fmr4tY7n9XdxnmZ0oum0x1GeGe5hkI"><meta property="og:url" content="https://nosari20.github.io/posts/windows-default-theme/"><meta property="og:title" content="Customize Windows 10+ default theme | Nosari20"><meta property="og:author" content="Florent NOSARI"><meta property="og:description" content="Customize the Windows 10+ default theme using PowerShell script (wallpaper, lockscreen, etc.)"><meta property="og:image" content="https://nosari20.github.io/posts/windows-default-theme/_og.png"><meta property="og:article:published_time" content="2022-09-13 00:00:00 +0000 UTC"><meta property="og:article:modified_time" content="2022-09-14 00:00:00 +0000 UTC"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="nosari20.github.io"><meta property="twitter:url" content="https://nosari20.github.io/posts/windows-default-theme/"><meta name=twitter:title content="Customize Windows 10+ default theme | Nosari20"><meta name=twitter:description content="Customize the Windows 10+ default theme using PowerShell script (wallpaper, lockscreen, etc.)"><meta name=twitter:image content="https://nosari20.github.io/posts/windows-default-theme/_og.png"><meta name=theme-color content="#302F2A"><link rel=icon href=/images/favicon.png><link rel=stylesheet href="/css/styles.css?v=2.1"><link rel=stylesheet href="/css/print.css?v=1.0" media=print></head><body><nav><div id=nav-toggle><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 17h18a1 1 0 01.117 1.993L21 19H3a1 1 0 01-.117-1.993L3 17h18H3zm0-6 18-.002a1 1 0 01.117 1.993l-.117.007L3 13a1 1 0 01-.117-1.993L3 11l18-.002L3 11zm0-6h18a1 1 0 01.117 1.993L21 7H3a1 1 0 01-.117-1.993L3 5h18H3z" fill="#fff"/></svg></div><a href=/><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.248 16.002c.966.0 1.75.784 1.75 1.75v2.498A1.75 1.75.0 016.248 22H3.75A1.75 1.75.0 012 20.25v-2.498c0-.966.784-1.75 1.75-1.75h2.498zM9.748 18h11.505a.75.75.0 01.102 1.493l-.102.007H9.748a.75.75.0 01-.102-1.493L9.748 18h11.505H9.748zm-3.5-8.999c.966.0 1.75.784 1.75 1.75v2.498a1.75 1.75.0 01-1.75 1.75H3.75A1.75 1.75.0 012 13.249V10.75C2 9.784 2.784 9 3.75 9h2.498zM9.748 11h11.505a.75.75.0 01.102 1.493l-.102.007H9.748a.75.75.0 01-.102-1.493L9.748 11h11.505H9.748zm-3.5-9c.966.0 1.75.784 1.75 1.75v2.498a1.75 1.75.0 01-1.75 1.75H3.75A1.75 1.75.0 012 6.248V3.75C2 2.784 2.784 2 3.75 2h2.498zm3.5 2h11.505a.75.75.0 01.102 1.493l-.102.007H9.748a.75.75.0 01-.102-1.493L9.748 4h11.505H9.748z" fill="#fff"/></svg>Home</a>
<a href=/tags/device-management/><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.254 8.003c.967.0 1.75.784 1.75 1.75v9.5a1.75 1.75.0 01-1.75 1.75H3.75A1.75 1.75.0 012 19.253v-9.5c0-.966.784-1.75 1.75-1.75h4.504zm-2.002 9.495h-.5a.75.75.0 100 1.5h.5a.75.75.0 000-1.5zM21.25 16.5a.75.75.0 01.102 1.493L21.25 18H11v-1.5h10.25zM18.25 5c.966.0 1.75.784 1.75 1.75v7.5A1.75 1.75.0 0118.25 16H11V9A2 2 0 009.15 7.006L9 7H4v-.25C4 5.784 4.784 5 5.75 5h12.5z" fill="#fff"/></svg>Device Management</a>
<a href=/tags/dev-scripting/><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m8.086 18.611 5.996-14.004a1 1 0 011.878.677l-.04.11-5.996 14.004a1 1 0 01-1.878-.677l.04-.11 5.996-14.004L8.086 18.61zm-5.793-7.318 4-4a1 1 0 011.497 1.32l-.083.094L4.414 12l3.293 3.293a1 1 0 01-1.32 1.498l-.094-.084-4-4a1 1 0 01-.083-1.32l.083-.094 4-4-4 4zm14-4.001a1 1 0 011.32-.083l.093.083 4.001 4.001a1 1 0 01.083 1.32l-.083.095-4.001 3.995a1 1 0 01-1.497-1.32l.084-.095L19.584 12l-3.293-3.294a1 1 0 010-1.414z" fill="#fff"/></svg>Dev. / Scripting</a>
<a href=/tags/misc/><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 4.5v6.238c0 .375-.094.744-.273 1.074L7.54 14h8.922l-1.188-2.188A2.25 2.25.0 0115 10.738V4.5h1A.75.75.0 0016 3H8a.75.75.0 000 1.5h1zm8.275 11H6.725l-1.582 2.915A1.75 1.75.0 006.68 21h10.638a1.75 1.75.0 001.538-2.585L17.275 15.5z" fill="#fff"/></svg>Misc.</a><footer><p class="footer text-center">Copyright (Â©) 2022 Florent NOSARI</p></footer></nav><section><header>Nosari20</header><article><image class=image-header alt="Customize Windows 10+ default theme" src=/posts/windows-default-theme/_header.png><h1><a class=title href=/posts/windows-default-theme/>Customize Windows 10+ default theme</a></h3><div class=metadata>Published on: <time datetime=2022-09-13>Sep 13, 2022</time>
- Last update: <time datetime=2022-09-14>Sep 14, 2022</time><div class=meta-url>Url: https://nosari20.github.io/posts/windows-default-theme/</div><ul class=tags><li><a href=https://nosari20.github.io/tags/device-management>device-management</a></li><li><a href=https://nosari20.github.io/tags/windows>windows</a></li><li><a href=https://nosari20.github.io/tags/powershell>powershell</a></li></ul></div><p><h2 id=content>Content</h2><ul><li>Purpose</li><li>Study</li><li>PowerShell script</li><li>Sources / usefull resources</li></ul><h2 id=purpose>Purpose</h2><p>One day, I wanted to change the default wallpaper and lockscreen of Windows compters for all the user profiles and let the users change these settings as they want. I find different ways by browsing Internet but they did not answere all my needs.
My needs were the folowing:</p><ul><li>Set custom wallpaper</li><li>Customize wallpaper screen</li><li>Set lockscreen</li><li>Allow users to change lockscreen</li><li>Apply this to existing and/or new profiles</li></ul><h2 id=study>Study</h2><h3 id=c-code-integration-wallpaper>C# code integration (wallpaper)</h3><h3 id=technical-basis>Technical basis</h3><p>This solution relies on the Win32 API function <a href=https://docs.microsoft.com/fr-fr/windows/win32/api/winuser/nf-winuser-systemparametersinfoa>SystemParametersInfo</a> from <code>user32.dll</code>. This script must be executed in User context or ran using <code>ServiceUI.exe</code> from <a href="https://www.microsoft.com/en-us/download/details.aspx?id=54259">Microsoft Deployment Toolkit</a></p><h3 id=limitations>Limitations</h3><ul><li>Must be executed in user context</li><li>Apply only on current user</li></ul><h4 id=code-snippet>Code snippet</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span><span style=color:#75715e># Define wallpaper function</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> Set-Wallpaper($MyWallpaper){
</span></span><span style=display:flex><span>    <span style=color:#75715e># Define C# code as string</span>
</span></span><span style=display:flex><span>    $code = @<span style=color:#e6db74>&#39; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    using System.Runtime.InteropServices; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace Win32{ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        public class Wallpaper{ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            [DllImport(&#34;user32.dll&#34;, CharSet=CharSet.Auto)] 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            public static void SetWallpaper(string thePath){ 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                SystemParametersInfo(20,0,thePath,3); 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    } 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span>@
</span></span><span style=display:flex><span>    <span style=color:#75715e># Import C# class</span>
</span></span><span style=display:flex><span>    Add-Type $code 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Call C# function</span>
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>Win32.Wallpaper</span>]::SetWallpaper($MyWallpaper)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Call your function</span>
</span></span><span style=display:flex><span>Set-WallPaper(<span style=color:#e6db74>&#34;C:\Wallpapers\nature.jpg&#34;</span>)
</span></span></code></pre></div><h3 id=registry-keys-lockscreen>Registry keys (lockscreen)</h3><h3 id=technical-basis-1>Technical basis</h3><p>We can use the following registry value to customize lockscreen:</p><p>Name: <code>LockScreenImage</code></p><p>Path: <code>HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization\LockScreenImage</code></p><p>Type: <code>String</code></p><p>Value: <code>&lt;path to lockscreen image></code></p><h3 id=limitations-1>Limitations</h3><ul><li>No limitation found yet</li></ul><h4 id=code-snippet-1>Code snippet</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>$regKey = <span style=color:#e6db74>&#39;HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create the key if it doesn&#39;t already exist</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (!(Test-Path -Path $regKey)) {
</span></span><span style=display:flex><span>   $null = New-Item -Path $regKey
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now set the registry entry</span>
</span></span><span style=display:flex><span>Set-ItemProperty -Path $regKey -Force -Name LockScreenImage -value <span style=color:#e6db74>&#34;C:\Custom-Folder\wallpaper.jpg&#34;</span>
</span></span></code></pre></div><h3 id=registry-keys-theme>Registry keys (theme)</h3><h3 id=technical-basis-2>Technical basis</h3><p>I found that we can simply customize the default theme using the following registry values:</p><table><thead><tr><th>Name</th><th>Path</th><th>Type</th><th>Value</th></tr></thead><tbody><tr><td><code>InstallTheme</code></td><td><code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes</code></td><td><code>String</code></td><td><code>&lt;path to theme file></code></td></tr><tr><td><code>DesktopBackground</code></td><td><code>HKLM\SOFTWARE\\Microsoft\Windows\CurrentVersion\Themes</code></td><td><code>String</code></td><td><code>&lt;path to background file></code></td></tr><tr><td><code>BrandIcon</code></td><td><code>HKLM\SOFTWARE\\Microsoft\Windows\CurrentVersion\Themes</code></td><td><code>String</code></td><td><code>&lt;path to icon file></code></td></tr><tr><td><code>ThemeName</code></td><td><code>HK\SOFTWARE\LM\Microsoft\Windows\CurrentVersion\Themes</code></td><td><code>String</code></td><td><code>&lt;THEME NAME></code></td></tr><tr><td><code>CurrentTheme</code></td><td><code>HKU\&lt;SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes</code></td><td><code>String</code></td><td><code>&lt;path to theme file></code></td></tr></tbody></table><p>Theme file:</p><p>Default theme path: <code>C:\Windows\resources\Themes\aero.theme</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e>; Copyright Â© Microsoft Corp.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Theme]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Windows - IDS_THEME_DISPLAYNAME_AERO</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DisplayName</span><span style=color:#f92672>=</span><span style=color:#e6db74>@%SystemRoot%\System32\themeui.dll,-2013</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SetLogonBackground</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Computer - SHIDI_SERVER</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[CLSID\{20D04FE0-3AEA-1069-A2D8-08002B30309D}\DefaultIcon]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DefaultValue</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\System32\imageres.dll,-109</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; UsersFiles - SHIDI_USERFILES</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[CLSID\{59031A47-3F72-44A7-89C5-5595FE6B30EE}\DefaultIcon]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DefaultValue</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\System32\imageres.dll,-123</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Network - SHIDI_MYNETWORK</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[CLSID\{F02C1A0D-BE21-4350-88B0-7367FC96EF3C}\DefaultIcon]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DefaultValue</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\System32\imageres.dll,-25</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Recycle Bin - SHIDI_RECYCLERFULL SHIDI_RECYCLER</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[CLSID\{645FF040-5081-101B-9F08-00AA002F954E}\DefaultIcon]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Full</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\System32\imageres.dll,-54</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Empty</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\System32\imageres.dll,-55</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Control Panel\Cursors]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AppStarting</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_working.ani</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Arrow</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_arrow.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Crosshair</span><span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Hand</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_link.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Help</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_helpsel.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>IBeam</span><span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>No</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_unavail.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>NWPen</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_pen.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SizeAll</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_move.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SizeNESW</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_nesw.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SizeNS</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_ns.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SizeNWSE</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_nwse.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SizeWE</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_ew.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>UpArrow</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_up.cur</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Wait</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\cursors\aero_busy.ani</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DefaultValue</span><span style=color:#f92672>=</span><span style=color:#e6db74>Windows Default</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DefaultValue.MUI</span><span style=color:#f92672>=</span><span style=color:#e6db74>@main.cpl,-1020</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Control Panel\Desktop]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Wallpaper</span><span style=color:#f92672>=</span><span style=color:#e6db74>%SystemRoot%\web\wallpaper\Windows\img0.jpg</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>TileWallpaper</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>WallpaperStyle</span><span style=color:#f92672>=</span><span style=color:#e6db74>10</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Pattern</span><span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[VisualStyles]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Path</span><span style=color:#f92672>=</span><span style=color:#e6db74>%ResourceDir%\Themes\Aero\Aero.msstyles</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ColorStyle</span><span style=color:#f92672>=</span><span style=color:#e6db74>NormalColor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Size</span><span style=color:#f92672>=</span><span style=color:#e6db74>NormalSize</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>AutoColorization</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ColorizationColor</span><span style=color:#f92672>=</span><span style=color:#e6db74>0XC40078D7</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SystemMode</span><span style=color:#f92672>=</span><span style=color:#e6db74>Dark</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[boot]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SCRNSAVE.EXE</span><span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[MasterThemeSelector]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>MTSM</span><span style=color:#f92672>=</span><span style=color:#e6db74>RJSPBS</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Sounds]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; IDS_SCHEME_DEFAULT</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>SchemeName</span><span style=color:#f92672>=</span><span style=color:#e6db74>@%SystemRoot%\System32\mmres.dll,-800</span>
</span></span></code></pre></div><p>In order to prevent misconfiguration, I suggest to either create a new theme file from the default file or customize the default theme file.</p><h3 id=limitations-2>Limitations</h3><ul><li>No limitation found yet</li></ul><h4 id=code-snippet-2>Code snippet</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span><span style=color:#75715e>################################# Global FUNCTIONS ################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>###################################################################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define function to update theme file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Function</span> Set-INIValue(){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span>(
</span></span><span style=display:flex><span>        [Parameter(<span style=color:#a6e22e>Mandatory</span>=$true, <span style=color:#a6e22e>Position</span>=<span style=color:#ae81ff>0</span>)] 
</span></span><span style=display:flex><span>        [ValidateNotNullOrEmpty()]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$INICOntent,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [Parameter(<span style=color:#a6e22e>Mandatory</span>=$true, <span style=color:#a6e22e>Position</span>=<span style=color:#ae81ff>1</span>)] 
</span></span><span style=display:flex><span>        [ValidateNotNullOrEmpty()]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$Category,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [Parameter(<span style=color:#a6e22e>Mandatory</span>=$true, <span style=color:#a6e22e>Position</span>=<span style=color:#ae81ff>2</span>)] 
</span></span><span style=display:flex><span>        [ValidateNotNullOrEmpty()]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$Key,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        [Parameter(<span style=color:#a6e22e>Mandatory</span>=$true, <span style=color:#a6e22e>Position</span>=<span style=color:#ae81ff>3</span>)] 
</span></span><span style=display:flex><span>        [ValidateNotNullOrEmpty()]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>string</span>]$Value
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span>($INICOntent <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;(?m)^</span>$Key<span style=color:#e6db74>=.*&#34;</span>){
</span></span><span style=display:flex><span>        $INICOntent <span style=color:#f92672>-Replace</span> <span style=color:#e6db74>&#34;(?m)^</span>$Key<span style=color:#e6db74>=.*&#34;</span>,<span style=color:#e6db74>&#34;</span>$Key<span style=color:#e6db74>=</span>$Value<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>Else</span>{
</span></span><span style=display:flex><span>        $INICOntent <span style=color:#f92672>-Replace</span> <span style=color:#e6db74>&#34;(?m)^\[</span>$Category<span style=color:#e6db74>\]&#34;</span>,<span style=color:#e6db74>&#34;[</span>$Category<span style=color:#e6db74>]</span><span style=color:#ae81ff>`n</span>$Key<span style=color:#e6db74>=</span>$Value<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################################# Customization ####################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>####################################################################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$THEME_NAME = <span style=color:#e6db74>&#34;CORPORATE&#34;</span>
</span></span><span style=display:flex><span>$THEME_FILENAME = <span style=color:#e6db74>&#34;corporate.theme&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Download theme or copy it from app package</span>
</span></span><span style=display:flex><span>New-Item <span style=color:#e6db74>&#34;C:\Windows\Web\Wallpaper\Corporate&#34;</span> -ItemType Directory -Force | Out-Null
</span></span><span style=display:flex><span>$WALLPAPER_PATH = <span style=color:#e6db74>&#34;C:\Windows\Web\Wallpaper\Corporate\wallpaper.png&#34;</span>
</span></span><span style=display:flex><span>Invoke-WebRequest -Uri <span style=color:#e6db74>&#34;https://wallpaper-house.com/data/out/10/wallpaper2you_388644.png&#34;</span> -OutFile <span style=color:#e6db74>&#34;</span>$WALLPAPER_PATH<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#--------------------------------------------------------------------------------------------------------------#</span>
</span></span><span style=display:flex><span>$THEME=@{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Theme:DisplayName&#34;</span>                         =       <span style=color:#e6db74>&#34;CORPORATE&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Control Panel\Desktop:Wallpaper&#34;</span>           =       <span style=color:#e6db74>&#34;</span>$WALLPAPER_PATH<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Control Panel\Desktop:WallpaperStyle&#34;</span>      =       <span style=color:#e6db74>&#34;10&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;VisualStyles:SystemMode&#34;</span>                    =      <span style=color:#e6db74>&#34;Dark&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;VisualStyles:ColorizationColor&#34;</span>            =       <span style=color:#e6db74>&#34;0XC40078D7&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;VisualStyles:AppMode&#34;</span>                      =       <span style=color:#e6db74>&#34;Dark&#34;</span> 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e># Doc: https://docs.microsoft.com/en-us/windows/win32/controls/themesfileformat-overview</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#--------------------------------------------------------------------------------------------------------------#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>################################# Logic ############################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>####################################################################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$THEME_REGISTRY_KEY = <span style=color:#e6db74>&#34;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes&#34;</span>
</span></span><span style=display:flex><span>$THEME_FOLDER = <span style=color:#e6db74>&#34;C:\Windows\resources\Themes&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Copy Current theme</span>
</span></span><span style=display:flex><span>$currentThemePath = <span style=color:#e6db74>&#34;</span>$(Get-ItemPropertyValue <span style=color:#e6db74>&#34;Registry::</span>$THEME_REGISTRY_KEY<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;InstallTheme&#34;</span>)<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>If</span>(<span style=color:#e6db74>&#34;</span>$currentThemePath<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>-ne</span> <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span>){
</span></span><span style=display:flex><span>    Copy-Item <span style=color:#e6db74>&#34;</span>$currentThemePath<span style=color:#e6db74>&#34;</span> -Destination <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Edit theme file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Get file content</span>
</span></span><span style=display:flex><span>$themeFileContent = Get-Content -Path <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span> | Out-String
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Customize theme</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Customize theme</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ForEach</span>($item <span style=color:#66d9ef>in</span> $THEME.Keys){
</span></span><span style=display:flex><span>    $themeFileContent =  Set-INIValue <span style=color:#e6db74>&#34;</span>$themeFileContent<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$(($item -Split <span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>0</span>])<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$(($item -Split <span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>1</span>])<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$($THEME[$item])<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Set file content</span>
</span></span><span style=display:flex><span>$themeFileContent | Out-File -FilePath  <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set as new theme</span>
</span></span><span style=display:flex><span>Set-ItemProperty -Path <span style=color:#e6db74>&#34;Registry::</span>$THEME_REGISTRY_KEY<span style=color:#e6db74>&#34;</span> -Name <span style=color:#e6db74>&#34;ThemeName&#34;</span> -Value <span style=color:#e6db74>&#34;</span>$THEME_NAME<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>Set-ItemProperty -Path <span style=color:#e6db74>&#34;Registry::</span>$THEME_REGISTRY_KEY<span style=color:#e6db74>&#34;</span> -Name <span style=color:#e6db74>&#34;InstallTheme&#34;</span> -Value <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h3 id=applying-theme-to-user-already-logged-in-optional>Applying theme to user already logged-in (optional)</h3><h3 id=technical-basis-3>Technical basis</h3><p>In order to apply the theme to the current user, you can use the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>rundll32.exe themecpl.dll,OpenThemeAction <span style=color:#e6db74>&#34;C:\path\to\mytheme.theme&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Source: https://stackoverflow.com/questions/546818/how-do-i-change-the-current-windows-theme-programmatically</span>
</span></span></code></pre></div><p>This code must be run in the user context, you can use <a href=https://github.com/KelvinTegelaar/RunAsUser>KelvinTegelaar/RunAsUser</a> or create your own system (this is what I choose)</p><h4 id=code-snippet-3>Code snippet</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span><span style=color:#75715e># Define function to execute code as logged-on user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Function</span> Invoke-AsCurrentUser(){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>param</span>(
</span></span><span style=display:flex><span>        [Parameter(<span style=color:#a6e22e>Mandatory</span>=$true, <span style=color:#a6e22e>Position</span>=<span style=color:#ae81ff>0</span>)] 
</span></span><span style=display:flex><span>        [ValidateNotNullOrEmpty()]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>String</span>]$Script
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create random name for task</span>
</span></span><span style=display:flex><span>    $taskName=<span style=color:#e6db74>&#34;Invoke-AsCurrentUser-</span>$(Get-Random -Maximum <span style=color:#ae81ff>1000</span>)<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Put code in temp file</span>
</span></span><span style=display:flex><span>    $Script | Out-File -FilePath <span style=color:#e6db74>&#34;C:\Users\Public\</span>$taskName<span style=color:#e6db74>.ps1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Define action</span>
</span></span><span style=display:flex><span>    $action = New-ScheduledTaskAction -Execute <span style=color:#e6db74>&#34;powershell.exe&#34;</span> -Argument <span style=color:#e6db74>&#34;-WindowStyle Hidden -Command &amp;{&amp;(&#39;C:\Users\Public\</span>$taskName<span style=color:#e6db74>.ps1&#39;) ; Remove-Item -Path &#39;C:\Users\Public\</span>$taskName<span style=color:#e6db74>.ps1&#39;}&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Define trigger to run the task in 1 minute</span>
</span></span><span style=display:flex><span>    $trigger = New-ScheduledTaskTrigger -AtLogon
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Define targeted user</span>
</span></span><span style=display:flex><span>    $principal = New-ScheduledTaskPrincipal -UserId (Get-CimInstance <span style=color:#960050;background-color:#1e0010>â</span>ClassName Win32_ComputerSystem | Select-Object -expand UserName)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create task</span>
</span></span><span style=display:flex><span>    $task = New-ScheduledTask -Action $action -Trigger $trigger -Principal $principal -Settings $settings
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Register task</span>
</span></span><span style=display:flex><span>    Register-ScheduledTask $taskName -InputObject $task
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Start Task</span>
</span></span><span style=display:flex><span>    Start-ScheduledTask -TaskName $taskName
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Launch process to remove scheduled task in 5 minutes</span>
</span></span><span style=display:flex><span>    Start-Process <span style=color:#e6db74>&#34;powershell.exe&#34;</span> <span style=color:#e6db74>&#34;Invoke-Command -ScriptBlock {Start-Sleep -Seconds 300;Unregister-ScheduledTask -TaskName </span><span style=color:#ae81ff>`&#34;</span>$taskName<span style=color:#ae81ff>`&#34;</span><span style=color:#e6db74> -Confirm:</span><span style=color:#ae81ff>`$</span><span style=color:#e6db74>false};&#34;</span> -WindowStyle Hidden
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set new theme to current user (run in user context)</span>
</span></span><span style=display:flex><span>Invoke-AsCurrentUser -Script (
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`$</span><span style=color:#e6db74>THEME_FOLDER=&#39;</span>$THEME_FOLDER<span style=color:#e6db74>&#39;;</span><span style=color:#ae81ff>`$</span><span style=color:#e6db74>THEME_FILENAME=&#39;</span>$THEME_FILENAME<span style=color:#e6db74>&#39;;&#34;</span>+
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    ({
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Set theme file using themecpl.dll &#39;OpenThemeAction&#39; function (https://windows10dll.nirsoft.net/themecpl_dll.html)</span>
</span></span><span style=display:flex><span>    rundll32.exe themecpl.dll,OpenThemeAction <span style=color:#e6db74>&#34;</span>$THEME_FOLDER<span style=color:#e6db74>\</span>$THEME_FILENAME<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Wait for process to start</span>
</span></span><span style=display:flex><span>    $loop=<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>While</span>(<span style=color:#e6db74>&#34;</span>$(Get-Process SystemSettings -ErrorAction SilentlyContinue)<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#34;&#34;</span>){
</span></span><span style=display:flex><span>        Start-Sleep -Milliseconds  <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        $loop=<span style=color:#ae81ff>+1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>If</span>($loop <span style=color:#f92672>-ge</span> <span style=color:#ae81ff>10</span>){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    Start-Sleep -Seconds <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Close process</span>
</span></span><span style=display:flex><span>    $loop=<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>While</span>(<span style=color:#e6db74>&#34;</span>$(Get-Process SystemSettings -ErrorAction SilentlyContinue)<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>-ne</span> <span style=color:#e6db74>&#34;&#34;</span>){
</span></span><span style=display:flex><span>        Start-Sleep -Milliseconds  <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        $loop=<span style=color:#ae81ff>+1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>If</span>($loop <span style=color:#f92672>-ge</span> <span style=color:#ae81ff>10</span>){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>Continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Get-Process SystemSettings -ErrorAction SilentlyContinue | Stop-Process -force
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}).toString())
</span></span></code></pre></div><h2 id=final-solution>Final solution</h2><p>Full code <a href=/posts/windows-default-theme/code/Set-Theme.ps1>here</a> (lockscreen left as default)</p><p><img src=/posts/windows-default-theme/result.png alt=Result></p><h2 id=sources--usefull-resources>Sources / usefull resources</h2><ul><li><a href=https://docs.microsoft.com/en-us/answers/questions/619056/powershell-to-set-second-monitor-wallpaper.html>https://docs.microsoft.com/en-us/answers/questions/619056/powershell-to-set-second-monitor-wallpaper.html</a></li><li><a href=https://stackoverflow.com/questions/69776800/how-to-set-lock-screen-photo-using-powershell>https://stackoverflow.com/questions/69776800/how-to-set-lock-screen-photo-using-powershell</a></li><li><a href=https://stackoverflow.com/questions/546818/how-do-i-change-the-current-windows-theme-programmatically>https://stackoverflow.com/questions/546818/how-do-i-change-the-current-windows-theme-programmatically</a></li><li><a href=https://windows10dll.nirsoft.net/themecpl_dll.html>https://windows10dll.nirsoft.net/themecpl_dll.html</a></li></ul></p></article><div id=comments><script>var id="1",commentsDiv;if(id){let t="https://github.com/nosari20/nosari20.github.io/issues/".concat(id),n="https://api.github.com/repos/nosari20/nosari20.github.io/issues/".concat(id,"/comments");commentsDiv=document.getElementById("comments");let e=new XMLHttpRequest;e.responseType="json",e.open("GET",n),e.setRequestHeader("Accept","application/vnd.github.v3.html+json"),e.send(),e.onload=function(){if(e.status!=200){let e=document.createElement("p");e.innerHTML="<i>Comments for this post yet are not opened yet (or you have GitHub scripts disabled).</i>",commentsDiv.appendChild(e)}else{let n=e.response,s=document.createElement("h2");s.innerHTML="Comments: ".concat(n.length),commentsDiv.appendChild(s);let o=document.createElement("p");o.innerHTML="<i>You can leave a comment using this <a href='".concat(t,"' target='_blank'>GitHub issue</a>.</i>"),commentsDiv.appendChild(o),n.forEach(function(e){let t=document.createElement("div");t.setAttribute("class","gh-comment"),t.innerHTML="".concat("<div class='gh-header'>","<img src='",e.user.avatar_url,"' />","<div style='margin:auto 0;'>","<b><a class='gh-username' href='",e.user.html_url,"' target='_blank'>",e.user.login,e.user.login=="nosari20"?" (OP)":"","</a></b>","<em> on ",new Date(e.created_at).toLocaleString("en"),"</em>","</div>","</div>","<div class='gh-body'>",e.body_html,"</div>"),commentsDiv.appendChild(t)})}},e.onerror=function(){let e=document.createElement("p");e.innerHTML="<i>Some error loading comments.</i>",commentsDiv.appendChild(e)}}</script></div></section><script src=/js/app.js></script></body></html>